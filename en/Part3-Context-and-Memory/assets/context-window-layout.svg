<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 420">
  <defs>
    <style>
      .label { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; letter-spacing: 0.5px; }
      .box-text { font: 600 13px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .title { font: 600 12px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; letter-spacing: 1px; }
      .section-label { font: 700 11px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: start; }
      .token-count { font: 500 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: end; }
      .priority { font: 500 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #fff; text-anchor: middle; }
    </style>
    <!-- Grid pattern -->
    <pattern id="grid-ctx" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e5e7eb" stroke-width="0.3"/>
    </pattern>
    <!-- Section patterns -->
    <pattern id="system-pattern" width="6" height="6" patternUnits="userSpaceOnUse">
      <circle cx="3" cy="3" r="1" fill="#7c3aed" opacity="0.2"/>
    </pattern>
    <pattern id="tool-pattern" width="5" height="5" patternUnits="userSpaceOnUse">
      <line x1="0" y1="5" x2="5" y2="0" stroke="#0891b2" stroke-width="0.5" opacity="0.3"/>
    </pattern>
    <pattern id="history-pattern" width="4" height="4" patternUnits="userSpaceOnUse">
      <line x1="0" y1="2" x2="4" y2="2" stroke="#059669" stroke-width="0.4" opacity="0.3"/>
    </pattern>
  </defs>

  <!-- White background -->
  <rect width="680" height="420" fill="#fff"/>

  <!-- Title -->
  <text x="340" y="28" class="title" text-anchor="middle">CONTEXT WINDOW LAYOUT</text>
  <text x="340" y="44" class="label">Typical Token Allocation</text>

  <!-- Main container with grid -->
  <rect x="60" y="60" width="480" height="320" fill="url(#grid-ctx)"/>
  <rect x="60" y="60" width="480" height="320" fill="none" stroke="#1a1a1a" stroke-width="1.5"/>

  <!-- Capacity indicator on left -->
  <g transform="translate(40, 60)">
    <line x1="0" y1="0" x2="0" y2="320" stroke="#ccc" stroke-width="2"/>
    <text x="-10" y="160" class="label" style="writing-mode: vertical-rl; text-orientation: mixed; fill: #999;">CAPACITY</text>
  </g>

  <!-- Section 1: System Prompt (Fixed, top) -->
  <rect x="60" y="60" width="480" height="50" fill="#ede9fe" stroke="#1a1a1a" stroke-width="1"/>
  <rect x="60" y="60" width="480" height="50" fill="url(#system-pattern)"/>
  <text x="80" y="90" class="section-label">SYSTEM PROMPT</text>
  <text x="300" y="90" class="label">System Instructions (Fixed)</text>
  <text x="530" y="85" class="token-count">~500</text>
  <text x="530" y="98" class="token-count" style="fill: #999;">tokens</text>
  <!-- Priority badge -->
  <rect x="430" y="72" width="50" height="18" fill="#7c3aed" rx="2"/>
  <text x="455" y="85" class="priority">FIXED</text>

  <!-- Section 2: Tool Results (Dynamic, important) -->
  <rect x="60" y="110" width="480" height="70" fill="#cffafe" stroke="#1a1a1a" stroke-width="1"/>
  <rect x="60" y="110" width="480" height="70" fill="url(#tool-pattern)"/>
  <text x="80" y="135" class="section-label">TOOL RESULTS</text>
  <text x="300" y="135" class="label">Tool Call Results</text>
  <text x="80" y="158" class="label" text-anchor="start" style="fill: #999;">Last 5 calls prioritized</text>
  <text x="530" y="140" class="token-count">~2,000</text>
  <text x="530" y="153" class="token-count" style="fill: #999;">tokens</text>
  <text x="530" y="170" class="token-count" style="fill: #0891b2;">Variable</text>
  <!-- Priority badge -->
  <rect x="430" y="117" width="50" height="18" fill="#0891b2" rx="2"/>
  <text x="455" y="130" class="priority">HIGH</text>

  <!-- Section 3: Conversation History (Dynamic, sliding) -->
  <rect x="60" y="180" width="480" height="130" fill="#d1fae5" stroke="#1a1a1a" stroke-width="1"/>
  <rect x="60" y="180" width="480" height="130" fill="url(#history-pattern)"/>
  <text x="80" y="205" class="section-label">CONVERSATION HISTORY</text>
  <text x="300" y="205" class="label">Chat History (Sliding Window)</text>

  <!-- Sliding window visualization -->
  <g transform="translate(100, 220)">
    <rect x="0" y="0" width="60" height="30" fill="#bbf7d0" stroke="#1a1a1a" stroke-width="0.5"/>
    <text x="30" y="20" class="label" style="font-size: 8px;">msg 1</text>
    <rect x="65" y="0" width="60" height="30" fill="#bbf7d0" stroke="#1a1a1a" stroke-width="0.5"/>
    <text x="95" y="20" class="label" style="font-size: 8px;">msg 2</text>
    <rect x="130" y="0" width="60" height="30" fill="#86efac" stroke="#1a1a1a" stroke-width="1"/>
    <text x="160" y="20" class="label" style="font-size: 8px;">msg 3</text>
    <rect x="195" y="0" width="60" height="30" fill="#86efac" stroke="#1a1a1a" stroke-width="1"/>
    <text x="225" y="20" class="label" style="font-size: 8px;">msg 4</text>
    <rect x="260" y="0" width="60" height="30" fill="#4ade80" stroke="#1a1a1a" stroke-width="1.5"/>
    <text x="290" y="20" class="label" style="font-size: 8px;">msg 5</text>
    <!-- Window bracket -->
    <line x1="130" y1="35" x2="130" y2="45" stroke="#059669" stroke-width="1.5"/>
    <line x1="130" y1="45" x2="320" y2="45" stroke="#059669" stroke-width="1.5"/>
    <line x1="320" y1="35" x2="320" y2="45" stroke="#059669" stroke-width="1.5"/>
    <text x="225" y="60" class="label" style="fill: #059669;">SLIDING WINDOW</text>
  </g>

  <text x="530" y="240" class="token-count">~4,000</text>
  <text x="530" y="253" class="token-count" style="fill: #999;">tokens</text>
  <!-- Priority badge -->
  <rect x="430" y="187" width="50" height="18" fill="#059669" rx="2"/>
  <text x="455" y="200" class="priority">FIFO</text>

  <!-- Section 4: Response Reserve (Reserved, bottom) -->
  <rect x="60" y="310" width="480" height="70" fill="#fef3c7" stroke="#1a1a1a" stroke-width="1"/>
  <text x="80" y="340" class="section-label">RESPONSE RESERVE</text>
  <text x="300" y="340" class="label">Reserved Response Space</text>
  <text x="80" y="363" class="label" text-anchor="start" style="fill: #999;">Ensures Agent has output space</text>
  <text x="530" y="340" class="token-count">~1,500</text>
  <text x="530" y="353" class="token-count" style="fill: #999;">tokens</text>
  <!-- Priority badge -->
  <rect x="430" y="317" width="60" height="18" fill="#ca8a04" rx="2"/>
  <text x="460" y="330" class="priority">RESERVED</text>

  <!-- Total indicator -->
  <g transform="translate(560, 200)">
    <rect x="0" y="0" width="90" height="60" fill="#f3f4f6" stroke="#1a1a1a" stroke-width="1" rx="4"/>
    <text x="45" y="22" class="section-label" text-anchor="middle">TOTAL</text>
    <text x="45" y="42" class="box-text">~8,000</text>
    <text x="45" y="55" class="label">tokens</text>
  </g>

  <!-- Legend -->
  <g transform="translate(60, 395)">
    <rect x="0" y="0" width="10" height="10" fill="#ede9fe"/>
    <text x="15" y="9" class="label" text-anchor="start" style="font-size: 8px;">Fixed</text>
    <rect x="60" y="0" width="10" height="10" fill="#cffafe"/>
    <text x="75" y="9" class="label" text-anchor="start" style="font-size: 8px;">Dynamic</text>
    <rect x="140" y="0" width="10" height="10" fill="#d1fae5"/>
    <text x="155" y="9" class="label" text-anchor="start" style="font-size: 8px;">Sliding</text>
    <rect x="210" y="0" width="10" height="10" fill="#fef3c7"/>
    <text x="225" y="9" class="label" text-anchor="start" style="font-size: 8px;">Reserved</text>
  </g>
</svg>
