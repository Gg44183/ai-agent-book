<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 680 320">
  <defs>
    <style>
      .label { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; letter-spacing: 0.5px; }
      .box-text { font: 600 13px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .box-text-en { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; }
      .title { font: 600 14px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; letter-spacing: 1px; }
      .annotation { font: 400 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; }
      .transition { font: 500 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; }
      .state-desc { font: 400 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
    </marker>
    <marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f59e0b"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="680" height="320" fill="#fff"/>

  <!-- Title -->
  <text x="340" y="28" class="title">CIRCUIT BREAKER STATE MACHINE</text>
  <text x="340" y="45" class="label">Circuit Breaker State Machine</text>

  <!-- CLOSED State (left) -->
  <rect x="60" y="120" width="140" height="70" fill="#d1fae5" stroke="#1a1a1a" stroke-width="2" rx="4"/>
  <text x="130" y="152" class="box-text">CLOSED</text>
  <text x="130" y="168" class="box-text-en">Normal Flow</text>
  <text x="130" y="182" class="state-desc">All requests allowed</text>

  <!-- OPEN State (right) -->
  <rect x="480" y="120" width="140" height="70" fill="#fecaca" stroke="#1a1a1a" stroke-width="2" rx="4"/>
  <text x="550" y="152" class="box-text">OPEN</text>
  <text x="550" y="168" class="box-text-en">Circuit Tripped</text>
  <text x="550" y="182" class="state-desc">All requests rejected</text>

  <!-- HALF-OPEN State (bottom center) -->
  <rect x="270" y="230" width="140" height="70" fill="#fef3c7" stroke="#1a1a1a" stroke-width="2" rx="4"/>
  <text x="340" y="262" class="box-text">HALF-OPEN</text>
  <text x="340" y="278" class="box-text-en">Testing</text>
  <text x="340" y="292" class="state-desc">Probe requests allowed</text>

  <!-- Transition: CLOSED -> OPEN (top arrow) -->
  <path d="M 200 140 Q 340 80 480 140" fill="none" stroke="#ef4444" stroke-width="2" marker-end="url(#arrow-red)"/>
  <text x="340" y="95" class="transition" fill="#ef4444">Consecutive failures >= 5</text>
  <text x="340" y="108" class="annotation" fill="#ef4444">FAILURE THRESHOLD</text>

  <!-- Transition: OPEN -> HALF-OPEN (right-bottom) -->
  <path d="M 530 190 Q 480 250 410 255" fill="none" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrow-orange)"/>
  <text x="490" y="235" class="transition" fill="#f59e0b">Wait 60s</text>
  <text x="490" y="248" class="annotation" fill="#f59e0b">TIMEOUT</text>

  <!-- Transition: HALF-OPEN -> CLOSED (left-bottom) -->
  <path d="M 270 255 Q 200 220 150 190" fill="none" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-green)"/>
  <text x="180" y="238" class="transition" fill="#10b981">Probe success</text>
  <text x="180" y="251" class="annotation" fill="#10b981">SUCCESS</text>

  <!-- Transition: HALF-OPEN -> OPEN (curved back) -->
  <path d="M 410 265 Q 450 265 480 230 Q 520 200 550 190" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#arrow-red)"/>
  <text x="520" y="255" class="annotation" fill="#ef4444">Probe failed</text>
</svg>
