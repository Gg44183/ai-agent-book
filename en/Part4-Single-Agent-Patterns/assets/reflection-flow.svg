<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 520 480">
  <defs>
    <style>
      .label { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; letter-spacing: 0.5px; }
      .box-text { font: 600 13px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .box-text-en { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; }
      .title { font: 600 14px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; letter-spacing: 1px; }
      .decision { font: 500 11px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .branch-label { font: 600 10px 'SF Mono', 'Menlo', 'Monaco', monospace; }
      .annotation { font: 400 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
    </marker>
    <marker id="arrow-loop" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7c3aed"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="520" height="480" fill="#fff"/>

  <!-- Title -->
  <text x="260" y="28" class="title">REFLECTION LOOP</text>
  <text x="260" y="45" class="label">Reflection Cycle Flow</text>

  <!-- Step 1: Initial Generation -->
  <rect x="160" y="65" width="200" height="50" fill="#dbeafe" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="260" y="90" class="box-text">Initial Generation</text>
  <text x="260" y="105" class="box-text-en">INITIAL GENERATION</text>

  <!-- Arrow down -->
  <line x1="260" y1="115" x2="260" y2="145" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Step 2: Quality Evaluation -->
  <rect x="160" y="150" width="200" height="50" fill="#a5f3fc" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="260" y="175" class="box-text">Quality Evaluation</text>
  <text x="260" y="190" class="box-text-en">QUALITY EVALUATION</text>

  <!-- Arrow down -->
  <line x1="260" y1="200" x2="260" y2="230" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Decision diamond -->
  <polygon points="260,235 345,280 260,325 175,280" fill="#fef3c7" stroke="#1a1a1a" stroke-width="1.5"/>
  <text x="260" y="273" class="decision">Score >= 0.7?</text>
  <text x="260" y="288" class="label">Score OK?</text>

  <!-- YES branch (right) - to return result -->
  <line x1="345" y1="280" x2="420" y2="280" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-green)"/>
  <text x="380" y="268" class="branch-label" fill="#10b981">YES</text>

  <!-- Return result box (right) -->
  <rect x="425" y="255" width="80" height="50" fill="#d1fae5" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="465" y="278" class="box-text" style="font-size: 11px;">Return</text>
  <text x="465" y="293" class="box-text-en" style="font-size: 9px;">RETURN</text>

  <!-- NO branch (down) -->
  <line x1="260" y1="325" x2="260" y2="360" stroke="#ef4444" stroke-width="2" marker-end="url(#arrow-red)"/>
  <text x="280" y="348" class="branch-label" fill="#ef4444">NO</text>

  <!-- Step 3: Generate Feedback -->
  <rect x="160" y="365" width="200" height="50" fill="#fce7f3" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="260" y="390" class="box-text">Generate Feedback</text>
  <text x="260" y="405" class="box-text-en">GENERATE FEEDBACK</text>

  <!-- Arrow down -->
  <line x1="260" y1="415" x2="260" y2="445" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Step 4: Regenerate with Feedback -->
  <rect x="140" y="450" width="240" height="25" fill="#67e8f9" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="260" y="467" class="box-text" style="font-size: 11px;">Regenerate w/ Feedback REGENERATE</text>

  <!-- Loop back arrow (left side) - purple color -->
  <path d="M 140 462 L 70 462 L 70 175 L 155 175"
        fill="none" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrow-loop)"/>

  <!-- Retry limit annotation on left -->
  <text x="45" y="300" class="annotation" fill="#7c3aed" style="writing-mode: vertical-rl; text-orientation: mixed;">RETRY &lt; N?</text>
  <text x="58" y="300" class="annotation" fill="#7c3aed" style="writing-mode: vertical-rl; text-orientation: mixed;">Retry count</text>

  <!-- Exit condition (bottom left) - dashed line -->
  <line x1="70" y1="400" x2="70" y2="450" stroke="#ef4444" stroke-width="1" stroke-dasharray="4,2"/>
  <line x1="70" y1="450" x2="20" y2="450" stroke="#ef4444" stroke-width="1" stroke-dasharray="4,2" marker-end="url(#arrow-red)"/>
  <text x="20" y="438" class="annotation" fill="#ef4444">Return best on limit</text>
  <text x="20" y="462" class="annotation" fill="#ef4444">MAX RETRIES</text>
</svg>
