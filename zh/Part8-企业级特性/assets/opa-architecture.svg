<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 580 380">
  <defs>
    <style>
      .label { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; letter-spacing: 0.5px; }
      .box-text { font: 600 12px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .title { font: 600 12px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; letter-spacing: 1px; }
      .component { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .desc { font: 400 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; }
    </style>
    <marker id="arrow-opa" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <pattern id="opa-pattern" width="6" height="6" patternUnits="userSpaceOnUse">
      <circle cx="3" cy="3" r="1" fill="#7c3aed" opacity="0.15"/>
    </pattern>
  </defs>

  <!-- White background -->
  <rect width="580" height="380" fill="#fff"/>

  <!-- Title -->
  <text x="290" y="25" class="title" text-anchor="middle">OPA POLICY ENGINE ARCHITECTURE</text>
  <text x="290" y="40" class="label">OPA 策略引擎架构</text>

  <!-- API Gateway -->
  <rect x="140" y="55" width="300" height="40" fill="#dbeafe" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="290" y="80" class="box-text">API Gateway</text>

  <!-- Arrow down -->
  <line x1="290" y1="95" x2="290" y2="120" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-opa)"/>
  <text x="320" y="112" class="label" text-anchor="start">请求</text>

  <!-- Policy Engine (OPA) - Main container -->
  <rect x="60" y="125" width="460" height="180" fill="#ede9fe" stroke="#1a1a1a" stroke-width="1.5" rx="4"/>
  <rect x="60" y="125" width="460" height="180" fill="url(#opa-pattern)" rx="4"/>
  <text x="290" y="145" class="box-text">Policy Engine (OPA)</text>

  <!-- Three policy boxes -->
  <rect x="80" y="160" width="120" height="50" fill="#ddd6fe" stroke="#1a1a1a" stroke-width="1" rx="2"/>
  <text x="140" y="183" class="component">base.rego</text>
  <text x="140" y="198" class="desc">(基础策略)</text>

  <rect x="220" y="160" width="120" height="50" fill="#c4b5fd" stroke="#1a1a1a" stroke-width="1" rx="2"/>
  <text x="280" y="183" class="component">custom.rego</text>
  <text x="280" y="198" class="desc">(自定义策略)</text>

  <rect x="360" y="160" width="140" height="50" fill="#a5f3fc" stroke="#1a1a1a" stroke-width="1" rx="2"/>
  <text x="430" y="183" class="component">decision_cache</text>
  <text x="430" y="198" class="desc">(LRU 缓存)</text>

  <!-- Merge lines -->
  <line x1="140" y1="210" x2="140" y2="225" stroke="#666" stroke-width="1"/>
  <line x1="280" y1="210" x2="280" y2="225" stroke="#666" stroke-width="1"/>
  <line x1="140" y1="225" x2="280" y2="225" stroke="#666" stroke-width="1"/>
  <line x1="210" y1="225" x2="210" y2="235" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-opa)"/>

  <!-- Rego Evaluation -->
  <rect x="140" y="240" width="140" height="35" fill="#fef3c7" stroke="#1a1a1a" stroke-width="1" rx="2"/>
  <text x="210" y="262" class="component">Rego Evaluation</text>

  <!-- Arrow down -->
  <line x1="210" y1="275" x2="210" y2="285" stroke="#666" stroke-width="1.5"/>
  <polygon points="205,285 210,295 215,285" fill="#666"/>

  <!-- Decision box -->
  <rect x="140" y="255" width="140" height="40" fill="#fff" stroke="#1a1a1a" stroke-width="1" rx="2" transform="translate(0, 45)"/>
  <text x="210" y="318" class="component">Decision</text>
  <text x="210" y="332" class="desc" style="fill: #059669;">allow / deny / warn</text>

  <!-- Arrow to Workflow -->
  <line x1="290" y1="305" x2="290" y2="335" stroke="#666" stroke-width="1.5" marker-end="url(#arrow-opa)"/>

  <!-- Workflow Execution -->
  <rect x="140" y="340" width="300" height="30" fill="#d1fae5" stroke="#1a1a1a" stroke-width="1.5" rx="2"/>
  <text x="290" y="360" class="box-text">Workflow Execution</text>
</svg>
