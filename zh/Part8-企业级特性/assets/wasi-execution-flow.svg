<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 620 420">
  <defs>
    <style>
      .label { font: 500 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: middle; letter-spacing: 0.5px; }
      .box-text { font: 600 12px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: middle; }
      .title { font: 600 12px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; letter-spacing: 1px; }
      .layer-title { font: 700 11px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #1a1a1a; text-anchor: start; }
      .detail { font: 400 9px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #666; text-anchor: start; }
      .grpc-label { font: 600 10px 'SF Mono', 'Menlo', 'Monaco', monospace; fill: #7c3aed; text-anchor: middle; }
    </style>
    <marker id="arrow-down" markerWidth="10" markerHeight="7" refX="5" refY="7" orient="auto">
      <polygon points="0 0, 10 0, 5 7" fill="#7c3aed"/>
    </marker>
    <!-- Patterns -->
    <pattern id="python-pattern" width="6" height="6" patternUnits="userSpaceOnUse">
      <circle cx="3" cy="3" r="1" fill="#3b82f6" opacity="0.2"/>
    </pattern>
    <pattern id="rust-pattern" width="5" height="5" patternUnits="userSpaceOnUse">
      <line x1="0" y1="5" x2="5" y2="0" stroke="#f97316" stroke-width="0.5" opacity="0.25"/>
    </pattern>
  </defs>

  <!-- White background -->
  <rect width="620" height="420" fill="#fff"/>

  <!-- Title -->
  <text x="310" y="25" class="title" text-anchor="middle">WASI EXECUTION ARCHITECTURE</text>
  <text x="310" y="40" class="label">WASI 沙箱执行架构</text>

  <!-- Layer 1: LLM Service (Python) -->
  <rect x="40" y="55" width="540" height="100" fill="#dbeafe" stroke="#1a1a1a" stroke-width="1.5" rx="4"/>
  <rect x="40" y="55" width="540" height="100" fill="url(#python-pattern)" rx="4"/>
  <text x="60" y="75" class="layer-title">LLM Service (Python)</text>

  <!-- Inner box: PythonWasiExecutorTool -->
  <rect x="60" y="85" width="500" height="60" fill="#eff6ff" stroke="#3b82f6" stroke-width="1" rx="2"/>
  <text x="310" y="105" class="box-text">PythonWasiExecutorTool</text>
  <text x="80" y="122" class="detail">• 接收 Python 代码</text>
  <text x="240" y="122" class="detail">• 构建 gRPC 请求</text>
  <text x="400" y="122" class="detail">• 调用 Agent Core</text>

  <!-- gRPC Arrow -->
  <line x1="310" y1="155" x2="310" y2="195" stroke="#7c3aed" stroke-width="2" marker-end="url(#arrow-down)"/>
  <text x="340" y="180" class="grpc-label">gRPC</text>

  <!-- Layer 2: Agent Core (Rust) -->
  <rect x="40" y="200" width="540" height="200" fill="#ffedd5" stroke="#1a1a1a" stroke-width="1.5" rx="4"/>
  <rect x="40" y="200" width="540" height="200" fill="url(#rust-pattern)" rx="4"/>
  <text x="60" y="220" class="layer-title">Agent Core (Rust)</text>

  <!-- Inner box: WasiSandbox -->
  <rect x="60" y="230" width="500" height="80" fill="#fff7ed" stroke="#f97316" stroke-width="1" rx="2"/>
  <text x="310" y="250" class="box-text">WasiSandbox</text>
  <text x="80" y="270" class="detail">• Wasmtime 引擎配置</text>
  <text x="80" y="285" class="detail">• 资源限制 (Fuel, Memory)</text>
  <text x="320" y="270" class="detail">• 文件系统隔离</text>
  <text x="320" y="285" class="detail">• 执行超时控制</text>

  <!-- Arrow down to Python WASM -->
  <line x1="310" y1="310" x2="310" y2="325" stroke="#666" stroke-width="1.5"/>
  <polygon points="305,325 310,335 315,325" fill="#666"/>

  <!-- Inner box: Python WASM -->
  <rect x="60" y="340" width="500" height="50" fill="#fce7f3" stroke="#1a1a1a" stroke-width="1" rx="2"/>
  <text x="310" y="360" class="box-text">python-3.11.4.wasm (20MB)</text>
  <text x="120" y="378" class="detail">• 完整 CPython 解释器</text>
  <text x="300" y="378" class="detail">• 标准库支持</text>
  <text x="440" y="378" class="detail">• 通过 stdin 接收代码</text>

  <!-- Language badges -->
  <rect x="520" y="60" width="50" height="18" fill="#3b82f6" rx="2"/>
  <text x="545" y="73" class="label" style="fill: #fff; font-size: 9px;">Python</text>

  <rect x="520" y="205" width="50" height="18" fill="#f97316" rx="2"/>
  <text x="545" y="218" class="label" style="fill: #fff; font-size: 9px;">Rust</text>
</svg>
